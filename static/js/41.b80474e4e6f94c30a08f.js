webpackJsonp([41],{"+Y0T":function(t,i,e){var n=e("lB6o");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);e("FIqI")("4ee1d10c",n,!0,{})},"+xdX":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("vbKY"),a=e("wKTW"),s=e("TVG1"),o=e("hRKE"),h=e.n(o),r={props:["allWProp","allHProp","vWProp","vHProp"],data:function(){return{img:null,imgX:0,imgY:0,imgW:0,imgH:0,imgWN:0,imgHN:0,_$:null,_$$:null,$:null,$$:null,vL:0,vT:0,vR:0,vB:0,_vT_add_vB:0,_vL_add_vR:0,_vL_mes_1:0,_vT_mes_1:0,_vW_add_2:0,_vH_add_2:0,rotateBtn:null,currRotateStep:0,touchType:0,pM:null,pZ:null}},computed:{allW:function(){return this.allWProp},allH:function(){return this.allHProp},vW:function(){return this.vWProp},vH:function(){return this.vHProp}},created:function(){a.a.$on("get-base64",this.doGetBase64)},mounted:function(){this.vW=this.vW<this.allW?this.vW:this.allW,this.vH=this.vH<this.allH?this.vH:this.allH,this.vL=(this.allW-this.vW)/2,this.vT=(this.allH-this.vH)/2,this.vR=this.vL+this.vW,this.vB=this.vT+this.vH,this._vT_add_vB=this.vT+this.vB,this._vL_add_vR=this.vL+this.vR,this._vL_mes_1=this.vL-1,this._vT_mes_1=this.vT-1,this._vW_add_2=this.vW+2,this._vH_add_2=this.vH+2,this._$=this.$el.children[0],this.$=this._$.getContext("2d"),this._$$=this.$el.children[1],this.$$=this._$$.getContext("2d"),this.rotateBtn=this.$el.querySelector("div.flip-btn"),this.drawMask(),window._fileReader&&this.putImageUrl(window._fileReader.result)},methods:{doGetBase64:function(t){var i=this.getImageBase64(t.width,t.height);a.a.$emit("put-base64",i)},doTouchStartHandler:function(t){t.target!=this.rotateBtn&&(t.preventDefault(),this.pM=[t.targetTouches[0].clientX,t.targetTouches[0].clientY],this.touchType=1,2==t.targetTouches.length&&(this.pZ=this.getZ(this.pM[0]-t.targetTouches[1].clientX,this.pM[1]-t.targetTouches[1].clientY),this.touchType=2))},doTouchMoveHandler:function(t){if(t.target!=this.rotateBtn){t.preventDefault();var i=[t.targetTouches[0].clientX,t.targetTouches[0].clientY];if(1==this.touchType&&1==t.targetTouches.length)this.imgX+=i[0]-this.pM[0],this.imgY+=i[1]-this.pM[1],this.pM=i,this.imgW>this.vW?this.imgX>this.vL?this.imgX=this.vL:this.imgX+this.imgW<this.vR&&(this.imgX=this.vR-this.imgW):this.imgX=(this._vL_add_vR-this.imgW)/2,this.imgH>this.vH?this.imgY>this.vT?this.imgY=this.vT:this.imgY+this.imgH<this.vB&&(this.imgY=this.vB-this.imgH):this.imgY=(this._vT_add_vB-this.imgH)/2;else if(2==this.touchType&&2==t.targetTouches.length){var e=this.getZ(i[0]-t.targetTouches[1].clientX,i[1]-t.targetTouches[1].clientY),n=e/this.pZ,a=this.imgW*n,s=this.imgH*n;(a>this.vW||s>this.vH)&&(this.imgX-=(a-this.imgW)/this.imgW*(this.allW/2-this.imgX),this.imgY-=(s-this.imgH)/this.imgH*(this.allH/2-this.imgY),this.imgW=a,this.imgH=s,this.pZ=e)}this.draw()}},doMouseWheelHandler:function(t){t.preventDefault();t.wheelDelta>0?(this.imgW*=1.05,this.imgH*=1.05):t.wheelDelta<0&&(this.imgW/=1.05,this.imgH/=1.05),this.draw()},doRotateImg:function(){this.currRotateStep=3==this.currRotateStep?0:this.currRotateStep+1,this.draw()},getZ:function(t,i){return Math.sqrt(t*t+i*i)},drawMask:function(){var t=this.$;t.fillStyle="rgba(0,0,0,0.7)",t.fillRect(0,0,this.allW,this.vT),t.fillRect(0,this.vB,this.allW,this.vT),t.fillRect(0,this.vT,this.vL,this.vH),t.fillRect(this.vR,this.vT,this.vL,this.vH),t.strokeStyle="rgba(225,255,225,1)",t.strokeRect(this._vL_mes_1,this._vT_mes_1,this._vW_add_2,this._vH_add_2)},draw:function(){var t=this.imgX+this.imgW/2,i=this.imgY+this.imgH/2,e=this.$;e.clearRect(0,0,this.allW,this.allH),e.save(),e.translate(t,i),e.rotate(90*this.currRotateStep*Math.PI/180),e.translate(-t,-i),e.drawImage(this.img,this.imgX,this.imgY,this.imgW,this.imgH),e.restore(),this.drawMask()},initImg:function(){this.imgW=this.imgWN=this.img.width,this.imgH=this.imgHN=this.img.height;var t=1/Math.min(this.imgW/this.vW,this.imgH/this.vH);this.imgW*=t,this.imgH*=t,this.imgX=(this._vL_add_vR-this.imgW)/2,this.imgY=(this._vT_add_vB-this.imgH)/2,this.draw()},putImageFromImg:function(t){if(null==t||"object"!=(void 0===t?"undefined":h()(t))||"img"!=t.tagName.toLowerCase())return!1;this.img=t,this.initImg()},putImageUrl:function(t){var i=this;if(null==t||""==t)return!1;i.img=new Image,i.img.onload=function(){i.initImg()},i.img.src=t},getImageBase64:function(t,i){var e=this._$$;e.style.display="block";var n=t/this.vW,a=i/this.vH;e.width=t,e.height=i;var s=(this.imgX-this.vL)*n,o=(this.imgY-this.vT)*a,h=this.imgW*n,r=this.imgH*a,l=s+h/2,d=o+r/2,c=this.$$;return c.save(),c.translate(l,d),c.rotate(90*this.currRotateStep*Math.PI/180),c.translate(-l,-d),c.drawImage(this.img,s,o,h,r),c.restore(),c.canvas.toDataURL("image/png")}},beforeDestroy:function(){a.a.$off("get-base64",this.doGetBase64)}},l={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"image-cut-container",style:{width:t.allW+"px",height:t.allH+"px"},on:{touchstart:function(i){t.doTouchStartHandler(i)},touchmove:function(i){t.doTouchMoveHandler(i)},mousewheel:function(i){t.doMouseWheelHandler(i)}}},[e("canvas",{style:{width:t.allW+"px",height:t.allH+"px"},attrs:{width:t.allW,height:t.allH}}),t._v(" "),e("canvas",{style:{top:t.vT+"px",left:t.vL+"px",width:t.vW+"px",height:t.vH+"px"}}),t._v(" "),e("div",{staticClass:"flip-btn",style:{top:t.vT+t.vH+15+"px"},on:{click:function(i){t.doRotateImg()}}},[t._v("翻转")])])},staticRenderFns:[]};var d={data:function(){return{global:n.a.data,type:"",inPostData:!1}},components:{ImageCut:e("Z0/y")(r,l,!1,function(t){e("f8Jn")},"data-v-25585baa",null).exports,PageTitle:e("a8Sk").a},created:function(){var t=this.global;window._fileReader?(this.type=t.currPage.query.type,t.loading=!1):this.$router.replace({name:"info"}),a.a.$on("put-base64",this.doPutBase64)},methods:{doClickSaveBtn:function(){if(this.inPostData)return s.a.tipShow("正在保存，请稍候...");this.inPostData=!0,a.a.$emit("get-base64",{width:160,height:160})},doPutBase64:function(t){var i=this;i.$http.post("../api/v2/profile/user/avatar/eidt",{avatar:t}).then(function(){n.a.updateUserNameAndHeader(),s.a.tipShow("保存成功！"),i.inPostData=!1,i.$router.push({name:"info"})})}},beforeDestroy:function(){a.a.$off("put-base64",this.doPutBase64)}},c={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"page info-page",attrs:{id:"picture-page"}},[e("PageTitle",{attrs:{"title-text":"裁剪图片",showBack:!1}},[e("div",{on:{click:function(i){t.doClickSaveBtn()}}},[t._v("保存")])]),t._v(" "),e("ImageCut",{attrs:{"all-w-prop":t.global.winWidth,"all-h-prop":t.global.winHeight,"v-w-prop":.8*t.global.winWidth,"v-h-prop":.8*t.global.winWidth}})],1)},staticRenderFns:[]};var g=e("Z0/y")(d,c,!1,function(t){e("+Y0T")},null,null);i.default=g.exports},a8Sk:function(t,i,e){"use strict";var n=e("vbKY"),a={data:function(){return{isShow:!0}},props:{titleText:{required:!0},showBack:{default:!0},toHome:{default:!1},hideInWx:{default:!1}},created:function(){this.hideInWx&&n.a.data.userAgent.isWX&&(this.isShow=!1)},methods:{doClickPageBack:function(){this.toHome?this.$router.push({name:"home"}):n.a.toBack()}}},s={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],staticClass:"page-title"},[t.showBack?e("a",{staticClass:"back",on:{click:function(i){t.doClickPageBack()}}}):t._e(),t._v(t._s(t.titleText)),t._t("default")],2)},staticRenderFns:[]},o=e("Z0/y")(a,s,!1,null,null,null);i.a=o.exports},f8Jn:function(t,i,e){var n=e("oblc");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);e("FIqI")("e772513a",n,!0,{})},lB6o:function(t,i,e){(t.exports=e("XLS9")(!1)).push([t.i,'\n.clearfix {\n  display: inline-block;\n}\n.clearfix:after {\n    display: block;\n    content: ".";\n    height: 0;\n    line-height: 0;\n    clear: both;\n    visibility: hidden;\n}\n@media (-webkit-min-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.7);\n    transform: scaleY(0.7);\n}\n}\n@media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.5);\n    transform: scaleY(0.5);\n}\n}\ndiv.info-page {\n  background-color: #fff;\n}\ndiv.info-page div.page-title > div {\n    position: absolute;\n    width: 3.5rem;\n    height: 2.611rem;\n    top: 0;\n    right: 0;\n    line-height: 2.611rem;\n    font-size: 0.778rem;\n    text-align: center;\n}\ndiv.info-page div.info-content {\n    border-bottom: 1px solid #e0e0e0;\n    background: #fff;\n}\ndiv.info-page div.info-content > div {\n      position: relative;\n      width: 18.666rem;\n      margin: 0 auto;\n      padding: 0.667rem;\n      border-top: solid 1px #D8D8D8;\n      font-size: 0.778rem;\n      display: -webkit-box;\n      display: -moz-box;\n      -webkit-box-align: center;\n      -moz-box-align: center;\n}\ndiv.info-page div.info-content > div:nth-of-type(1) {\n        border: 0;\n}\ndiv.info-page div.info-content > div > input {\n        position: absolute;\n        opacity: 0;\n        width: 17.332rem;\n        height: 4.666rem;\n}\ndiv.info-page div.info-content > div > div:nth-of-type(1) {\n        margin-right: 0.667rem;\n}\ndiv.info-page div.info-content > div > div:nth-of-type(2) {\n        color: #4d4d4d;\n        font-size: .778rem;\n        padding: 0;\n        margin: 0;\n}\ndiv.info-page div.info-content > div > div:nth-of-type(2).header {\n          width: 4.666rem;\n          height: 4.666rem;\n          background-size: 4.666rem 4.666rem;\n          background-repeat: no-repeat;\n          border-radius: 0.6rem;\n}\ndiv.info-page div.info-content > div > div:nth-of-type(2) > input {\n          color: #4d4d4d;\n          font-size: .778rem;\n          outline: 0;\n          border: 0;\n          width: 13rem;\n          padding: 0;\n          margin: 0;\n}\ndiv.info-page div.info-content > div > div.tip {\n        width: 11rem;\n        text-align: right;\n}\ndiv.info-page .submit {\n    width: 80%;\n    height: 2.22222rem;\n    line-height: 2.22222rem;\n    border-radius: 0.22222rem;\n    margin: 1.11111rem auto;\n    background-color: #0abe07;\n    color: #fff;\n    text-align: center;\n}\ndiv.info-page .submit.loading {\n      background-color: #eee;\n}\n',""])},oblc:function(t,i,e){(t.exports=e("XLS9")(!1)).push([t.i,"\ndiv.image-cut-container[data-v-25585baa] {\n    position: relative;\n    background: #000;\n}\ndiv.image-cut-container > canvas[data-v-25585baa]:nth-of-type(2) {\n    display: none;\n    position: absolute;\n    background: #000;\n}\ndiv.image-cut-container > div.flip-btn[data-v-25585baa] {\n    position: absolute;\n    height: 2.08rem;\n    width: 6.324rem;\n    left: 50%;\n    margin-left: -3.167rem;\n    line-height: 2.08rem;\n    border-radius: 1.1rem;\n    font-size: 0.9rem;\n    color: #666;\n    text-align: center;\n    background-color: #ccc\n}\n",""])}});