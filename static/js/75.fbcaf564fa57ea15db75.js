webpackJsonp([75],{J4Wv:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("3cXf"),o=n.n(i),a=n("vbKY"),s=n("zDZx"),r=n("TVG1"),d={filters:{MsgTimeFormatter:n("o7v+").a},data:function(){return{global:a.a.data,contactList:[],contactIndexObj:{},inEdit:!1,showConfirmDel:!1,showDataLoadTip:!1,showFinishLoadTip:!1,isDataAddEnd:!1,isAddData:!1,currPage:0,pageSize:10,currShow:"message",menuShow:!1,currScrollTop:0}},computed:{sessionList:function(){for(var e=this.global,t=this.$store.state.sessionList,n=[],i=void 0,o=0;o<t.length;o++)(i=t[o]).name&&i.time&&"@@"!=i.recentMsg&&("club"==e.pageMode&&i.clubId==e.clubId||"club"!=e.pageMode&&a.a.isClubInXmdAppId(i.clubId))&&(i.headerUrl=(i.header?"url("+i.header+"),":"")+"url("+("tech"==i.type?e.defaultHeader:e.defaultManagerHeader)+")",n.push(i));return n.length>0&&n.sort(function(e,t){return e.time>t.time?-1:1}),n}},mounted:function(){var e=this,t=e.global,n=t.currPage.query,i="club"==t.pageMode?t.clubId:"",o=r.a.sessionStorage,s=r.a.removeSessionStorage,d=o("message-data");document.title=a.a.setPageTitle("message")||"消息",d=d?JSON.parse(d):null,e.currShow=n.type||"message",d&&d.clubId==i?(e.contactList=d.contactList,e.showFinishLoadTip=d.showFinishLoadTip,e.isDataAddEnd=d.isDataAddEnd,e.currPage=d.currPage,e.$nextTick(function(){setTimeout(function(){e.$refs.listEle.scrollTop=d.top||0,t.loading=!1},100)})):(e.queryContact(),t.loading=!1),d&&s("message-data")},methods:{doChangeConfirmPop:function(e){this.showConfirmDel=e},doClearChatList:function(e){var t=this.global;s.a.delAllMessage(t.clubId,e),r.a.tipShow("删除成功！"),this.showConfirmDel=!1,this.$store.state.newMessageTotal=0},doSwitchTab:function(e){this.currShow=e,this.$router.replace({name:"message",query:{type:e}})},queryContact:function(e){var t=this,n=this,i=n.global;n.isAddData||(n.isAddData=!0,e=e||n.currPage+1,n.showDataLoadTip=!0,n.showFinishLoadTip=!1,n.isDataAddEnd=!1,n.$http.get("../api/v1/emchat/friendlist/{id}",{params:{id:s.a.id,page:e,pageSize:n.pageSize,channel:"center"}}).then(function(o){if(o=o.body){o="200"!=o.statusCode?[]:o.respData;for(var a=void 0,d=void 0,l=void 0,c=void 0,m=t.contactList,g=0;g<o.length;g++)a=o[g],"club"==i.pageMode&&a.clubId!=i.clubId||!a.clubName||(void 0==(c=n.contactIndexObj[a.clubId])?(l={clubName:a.clubName,list:[]},n.contactIndexObj[a.clubId]=m.length,m.push(l)):l=m[c],a.friendDescription=a.friendDescription||"",(d=s.a.getSessionObj[a.friendChatId])?(d=d.obj,a.msgStr=d.recentMsg,a.time=d.time):a.msgStr=s.a.decodeExpression(a.friendDescription.replace(/<br>|<br\/>/g,"")),l.list.push(a));0==o.length&&(n.isDataAddEnd=!0,1!=e&&(n.showFinishLoadTip=!0)),n.currPage=e,n.isAddData=!1,n.showDataLoadTip=!1}else r.a.tipShow(i.loadError)},function(){r.a.tipShow(i.loadError)}))},doHandlerListScroll:function(){var e=this.$refs.listEle;this.currScrollTop=e.scrollTop,!this.isDataAddEnd&&e.scrollTop+1.4*e.clientHeight>e.scrollHeight&&this.queryContact()},doClickSessionRecord:function(e){s.a.setTalker(e),this.$router.push({name:"chat",query:{techId:e.userId,clubId:e.clubId}})},doClickContactRecord:function(e){var t={id:e.friendChatId,name:e.friendName,userId:e.friendUserId,header:e.friendAvatarUrl,serialNo:e.techNo,clubId:e.clubId,type:e.toType};s.a.setTalker(t),this.$router.push({name:"chat",query:{techId:e.friendUserId,clubId:e.clubId}})},menuSet:function(){this.menuShow=!this.menuShow},doClickDelRecord:function(e,t){t.stopPropagation();var n=this,i=n.global;n.$http.post("../api/v1/emchat/friend",{channel:"center",currentChatId:s.a.id,showFlag:"n",friendChatId:e.friendChatId}).then(function(t){if(200==(t=t.body).statusCode){var o=n.contactList[n.contactIndexObj[e.clubId]];o&&o.list.splice(o.list.indexOf(e),1)}else r.a.tipShow(t.msg||i.loadError)},function(){r.a.tipShow(i.loadError)})},doClickDelBtn:function(){this.inEdit=!this.inEdit,this.menuShow=!1}},beforeDestroy:function(){var e=this.global;(0,r.a.sessionStorage)("message-data",o()({clubId:"club"==e.pageMode?e.clubId:"",contactList:this.contactList,showFinishLoadTip:this.showFinishLoadTip,isDataAddEnd:this.isDataAddEnd,currPage:this.currPage,contactIndexObj:this.contactIndexObj,top:this.currScrollTop}))}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page",attrs:{id:"message-page"}},[n("div",{staticClass:"tool-title"},[n("div",[n("div",{class:{active:"message"==e.currShow},on:{click:function(t){e.doSwitchTab("message")}}},[e._v("消息")]),e._v(" "),n("div",{class:{active:"contact"==e.currShow},on:{click:function(t){e.doSwitchTab("contact")}}},[e._v("联系人")])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"message"==e.currShow&&e.sessionList.length>0,expression:"currShow=='message' && sessionList.length>0"}],on:{click:function(t){e.doChangeConfirmPop(!0)}}},[e._v("清空")]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"contact"==e.currShow,expression:"currShow=='contact'"}]},[e.inEdit?n("span",{on:{click:e.doClickDelBtn}},[e._v("完成")]):n("i",{staticClass:"icon-more",on:{click:e.menuSet}}),e._v(" "),e.menuShow?n("ul",{attrs:{id:"menu-more"}},[n("li",{staticClass:"del-contacts",on:{click:e.doClickDelBtn}},[e._v("删除")]),e._v(" "),n("router-link",{staticClass:"blacklist",attrs:{to:{name:"blacklist"},tag:"li"}},[e._v("黑名单管理")])],1):e._e()])]),e._v(" "),n("div",{staticClass:"list-wrap",class:{active:"contact"==e.currShow},style:{height:e.global.winHeight-2.611*e.global.winScale*16+"px"}},[n("div",{staticClass:"list",on:{scroll:e.doHandlerListScroll}},[e._l(e.sessionList,function(t){return n("div",{key:t.id,staticClass:"list-item",on:{click:function(n){e.doClickSessionRecord(t)}}},[n("div",{style:{"background-image":t.headerUrl}}),e._v(" "),n("div",[n("div",[n("div",[n("div",[e._v(e._s(t.name))]),e._v(" "),n("div",{class:"tech"!=t.type?"manager":t.serialNo?"tech":"none"},[e._v(e._s("manager"==t.type?"店长":"servicer"==t.type?"客服":t.serialNo))])]),e._v(" "),n("div",[e._v(e._s(e._f("MsgTimeFormatter")(t.time)))])]),e._v(" "),n("div",{class:t.recentMsg},[n("div",{domProps:{innerHTML:e._s(t.recentMsg||"&nbsp;")}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.newMsgCount>0,expression:"item.newMsgCount>0"}]},[e._v(e._s(t.newMsgCount))])])])])}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0==e.sessionList.length,expression:"sessionList.length==0"}],staticClass:"nullData"},[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.global.loading,expression:"!global.loading"}]}),e._v(" "),n("div",[e._v(e._s(e.global.loading?"数据加载中...":"暂无内容..."))])])],2),e._v(" "),n("div",{ref:"listEle",staticClass:"list",on:{scroll:e.doHandlerListScroll}},[e._l(e.contactList,function(t){return n("div",{directives:[{name:"show",rawName:"v-show",value:t.list.length>0,expression:"item.list.length>0"}],key:t.clubId},[n("div",{directives:[{name:"show",rawName:"v-show",value:"club"!=e.global.pageMode,expression:"global.pageMode != 'club'"}],staticClass:"club-name"},[e._v(e._s(t.clubName))]),e._v(" "),n("ul",e._l(t.list,function(i){return n("li",{key:i.chatId,staticClass:"list-item",on:{click:function(t){e.doClickContactRecord(i)}}},[n("div",{style:{"background-image":"url("+(i.friendAvatarUrl?i.friendAvatarUrl:e.global.defaultManagerHeader)+"),url("+("manager"!=t.toType?e.global.defaultHeader:e.global.defaultManagerHeader)+")"}}),e._v(" "),n("div",[n("div",[n("div",[n("div",[e._v(e._s(i.friendName))]),e._v(" "),n("div",{class:"manager"==i.toType?"manager":i.techNo&&i.techNo.length>0?"tech":"none"},[e._v(e._s("manager"==i.toType?"店长":i.techNo))])])]),e._v(" "),n("div",[n("div",{domProps:{innerHTML:e._s(i.msgStr||"&nbsp;")}})]),e._v(" "),n("div",{class:{active:e.inEdit},on:{click:function(t){e.doClickDelRecord(i,t)}}},[e._v("×")])])])}))])}),e._v(" "),n("div",{staticClass:"data-load-tip",class:{none:!e.showDataLoadTip}},[n("div",[e._v("加载数据")])]),e._v(" "),n("div",{staticClass:"finish-load-tip",class:{none:!e.showFinishLoadTip||0==e.contactList.length}},[n("div",[e._v("已经加载全部数据")])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0==e.contactList.length&&!e.isAddData,expression:"contactList.length==0 && !isAddData"}],staticClass:"nullData"},[n("div"),n("div",[e._v(e._s(e.global.loading?"数据加载中...":"暂无内容..."))])])],2)]),e._v(" "),n("div",{staticClass:"confirm-del",class:{active:e.showConfirmDel}},[n("div",[n("div",{on:{click:function(t){e.doClearChatList(!0)}}},[e._v("列表及聊天记录")]),e._v(" "),n("div",{on:{click:function(t){e.doClearChatList(!1)}}},[e._v("聊天记录")]),e._v(" "),n("div",{on:{click:function(t){e.doChangeConfirmPop(!1)}}},[e._v("取消")])])])])},staticRenderFns:[]};var c=n("Z0/y")(d,l,!1,function(e){n("MB9d")},null,null);t.default=c.exports},MB9d:function(e,t,n){var i=n("aQfE");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("FIqI")("7ff69fea",i,!0,{})},aQfE:function(e,t,n){(e.exports=n("XLS9")(!1)).push([e.i,'\n.clearfix {\n  display: inline-block;\n}\n.clearfix:after {\n    display: block;\n    content: ".";\n    height: 0;\n    line-height: 0;\n    clear: both;\n    visibility: hidden;\n}\n@media (-webkit-min-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.7);\n    transform: scaleY(0.7);\n}\n}\n@media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.5);\n    transform: scaleY(0.5);\n}\n}\ndiv#message-page {\n  background: #fff;\n  width: 20rem;\n  overflow-x: hidden;\n}\ndiv#message-page .tool-title {\n    position: relative;\n    background-color: #ededed;\n    height: 2.611rem;\n    border-bottom: 1px solid #d9d9d9;\n    color: #4d4d4d;\n    display: -webkit-box;\n    display: -moz-box;\n    -webkit-box-pack: center;\n    -moz-box-pack: center;\n    -webkit-box-align: center;\n    -moz-box-align: center;\n}\ndiv#message-page .tool-title > div:nth-of-type(1) {\n      display: -webkit-box;\n      display: -moz-box;\n      -webkit-box-pack: center;\n      -moz-box-pack: center;\n      -webkit-box-align: center;\n      -moz-box-align: center;\n      width: 8.333rem;\n      height: 1.5rem;\n      border: 1px solid #f66;\n      color: #f66;\n      font-size: .889rem;\n      border-radius: 4px;\n}\ndiv#message-page .tool-title > div:nth-of-type(1) > div {\n        width: 50%;\n        height: 100%;\n        text-align: center;\n        line-height: 1.35rem;\n}\ndiv#message-page .tool-title > div:nth-of-type(1) > div:nth-of-type(1) {\n          border-top-left-radius: 4px;\n          border-bottom-left-radius: 4px;\n}\ndiv#message-page .tool-title > div:nth-of-type(1) > div:nth-of-type(2) {\n          border-top-right-radius: 4px;\n          border-bottom-right-radius: 4px;\n}\ndiv#message-page .tool-title > div:nth-of-type(1) > div.active {\n          color: #fff;\n          background-color: #f66;\n}\ndiv#message-page .tool-title > div:nth-of-type(2), div#message-page .tool-title > div:nth-of-type(3) {\n      position: absolute;\n      font-size: .85rem;\n      right: .667rem;\n      top: 50%;\n      -webkit-transform: translate(0, -50%);\n      transform: translate(0, -50%);\n}\ndiv#message-page .tool-title > div:nth-of-type(2) {\n      -webkit-transform-origin: left center;\n      transform-origin: left center;\n}\ndiv#message-page .tool-title > div:nth-of-type(3) {\n      z-index: 99;\n}\ndiv#message-page .tool-title > div:nth-of-type(3) .icon-more {\n        font-size: 1.38889rem;\n        padding: .3rem;\n        vertical-align: middle;\n}\ndiv#message-page .tool-title > div:nth-of-type(3) ul {\n        margin: 0;\n        padding: 0;\n        position: absolute;\n        width: 6.94444rem;\n        height: 5em;\n        line-height: 2.5em;\n        top: 2.5rem;\n        right: -.4rem;\n        background: #fff;\n        text-align: center;\n        border: 1px solid #333;\n        border-radius: 0.27778rem;\n}\ndiv#message-page .tool-title > div:nth-of-type(3) ul li {\n          list-style: none;\n          width: 80%;\n          margin: 0 auto;\n          height: 2.5em;\n          border-bottom: 1px solid #333;\n}\ndiv#message-page .tool-title > div:nth-of-type(3) ul li:last-child {\n            border-bottom: 0;\n}\ndiv#message-page div.list-wrap {\n    width: 40rem;\n    padding-bottom: 3rem;\n    -webkit-transition: -webkit-transform 0.3s ease-out;\n    transition: -webkit-transform 0.3s ease-out;\n    transition: transform 0.3s ease-out;\n    transition: transform 0.3s ease-out, -webkit-transform 0.3s ease-out;\n}\ndiv#message-page div.list-wrap.active {\n      -webkit-transform: translateX(-50%);\n              transform: translateX(-50%);\n}\ndiv#message-page div.list {\n    width: 20rem;\n    height: 100%;\n    float: left;\n    overflow-y: auto;\n}\ndiv#message-page .club-name {\n    position: relative;\n    width: 100%;\n    padding: 0 .6777rem;\n    margin-top: -1px;\n    border-top: 1px solid #d9d9d9;\n    border-bottom: 1px solid #d9d9d9;\n    background-color: #f5f5f5;\n    color: #616161;\n    font-size: .778rem;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\ndiv#message-page .list-item {\n    padding: 0 .667rem;\n    display: -webkit-box;\n    display: -moz-box;\n    -webkit-box-align: center;\n    -moz-box-align: center;\n}\ndiv#message-page .list-item > div:nth-of-type(1) {\n      width: 2.444rem;\n      height: 2.444rem;\n      background-size: 2.444rem 2.444rem;\n      background-repeat: no-repeat;\n      margin-right: .667rem;\n      border-radius: 50%;\n}\ndiv#message-page .list-item > div:nth-of-type(2) {\n      padding: .667rem 0;\n      border-bottom: 1px solid #eee;\n      -webkit-box-flex: 1;\n      box-flex: 1;\n      position: relative;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) {\n        display: -webkit-box;\n        display: -moz-box;\n        -webkit-box-align: center;\n        -moz-box-align: center;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(1) {\n          -webkit-box-flex: 1;\n          box-flex: 1;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          display: -webkit-box;\n          display: -moz-box;\n          -webkit-box-align: center;\n          -moz-box-align: center;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(1) > div:nth-of-type(1) {\n            max-width: 10rem;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            font-size: .889rem;\n            color: #4d4d4d;\n            margin-right: .3rem;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(1) > div:nth-of-type(2) {\n            min-width: 2.433rem;\n            max-width: 3.5rem;\n            height: .722rem;\n            text-align: center;\n            font-size: .556rem;\n            color: #999;\n            border: 1px solid #999;\n            border-radius: .361rem;\n            line-height: 0.755rem;\n            -webkit-box-sizing: content-box;\n                    box-sizing: content-box;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(1) > div:nth-of-type(2).none {\n              display: none;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(1) > div:nth-of-type(2).manager {\n              border-color: #f66;\n              color: #f66;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(1) > div:nth-of-type(2) {\n          font-size: .611rem;\n          color: #999;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(2) {\n        display: -webkit-box;\n        display: -moz-box;\n        -webkit-box-align: center;\n        -moz-box-align: center;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(2) > div:nth-of-type(1) {\n          -webkit-box-flex: 1;\n          box-flex: 1;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          font-size: .722rem;\n          color: #999;\n          margin-right: .5rem;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(2) > div:nth-of-type(2) {\n          min-width: 1rem;\n          height: 1rem;\n          line-height: 1rem;\n          text-align: center;\n          background-color: #f66;\n          color: #fff;\n          font-size: .7rem;\n          border-radius: 50%;\n          padding-left: 0.15rem;\n          padding-right: 0.15rem;\n          -webkit-transform: scale(0.8, 0.8);\n                  transform: scale(0.8, 0.8);\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(3) {\n        position: absolute;\n        right: 0.5rem;\n        top: 35%;\n        width: 1.056rem;\n        height: 1.056rem;\n        background-color: #f66;\n        color: #fff;\n        opacity: 0;\n        font-size: .989rem;\n        text-align: center;\n        line-height: 1rem;\n        margin-left: .667rem;\n        border-radius: 50%;\n        -webkit-box-sizing: content-box;\n                box-sizing: content-box;\n        -webkit-transform: scale(0, 0);\n                transform: scale(0, 0);\n        -webkit-transition: opacity .3s, -webkit-transform .3s ease;\n        transition: opacity .3s, -webkit-transform .3s ease;\n        transition: transform .3s ease, opacity .3s;\n        transition: transform .3s ease, opacity .3s, -webkit-transform .3s ease;\n}\ndiv#message-page .list-item > div:nth-of-type(2) > div:nth-of-type(3).active {\n          opacity: 1;\n          -webkit-transform: scale(1, 1);\n                  transform: scale(1, 1);\n}\ndiv#message-page .confirm-del {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 10;\n    opacity: 0;\n    -webkit-transform: scale(0, 0);\n    transform: scale(0, 0);\n    -webkit-transform-origin: 50% 100%;\n    transform-origin: 50% 100%;\n    -webkit-transition: all 0.3s;\n    transition: all 0.3s;\n}\ndiv#message-page .confirm-del > div {\n      position: absolute;\n      bottom: .667rem;\n      padding: 0 .667rem;\n      width: 100%;\n}\ndiv#message-page .confirm-del > div > div {\n        background-color: #fff;\n        font-size: .889rem;\n        color: #616161;\n        height: 2.444rem;\n        line-height: 2.444rem;\n        text-align: center;\n        border-radius: .3rem;\n        margin-top: .667rem;\n}\ndiv#message-page .confirm-del.active {\n      opacity: 1;\n      -webkit-transform: scale(1, 1);\n      transform: scale(1, 1);\n}\n',""])},"o7v+":function(e,t,n){"use strict";t.a=function(e,t){e||(e=new Date);var n=e instanceof Date?e:new Date(1e3*e),i=n.getMonth(),o=n.getDate(),a=n.getHours(),s=n.getMinutes(),r=n.getSeconds(),d=(a=a>9?a:"0"+a)+":"+(s=s>9?s:"0"+s)+":"+(r=r<10?"0"+r:r),l=new Date;if(n.getFullYear()===l.getFullYear()){if(i===l.getMonth()){if(o===l.getDate())return t?d:a+":"+s;if(l.setTime(l.getTime()-864e5),o===l.getDate())return t?"昨天 "+d:"昨天";if(l.setTime(l.getTime()-864e5),o===l.getDate())return t?"前天 "+d:"前天"}return((i+=1)<9?"0"+i:i)+"-"+(o<9?"0"+o:o)+(t?" "+d:"")}return i+=1,n.getFullYear()+"-"+(i<9?"0"+i:i)+"-"+(o<9?"0"+o:o)+(t?" "+d:"")}}});