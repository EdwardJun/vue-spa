webpackJsonp([73],{"1es7":function(e,n,t){"use strict";(function(e){var a=t("3cXf"),o=t.n(a),i=t("vbKY"),r=t("TVG1"),s=t("bg9g");n.a={filters:{MoneyFormatter:s.a},data:function(){return{global:i.a.data,paramData:null,payAuthCode:"",openId:"",inProcessing:!1,isNativeOrder:!1,consumeList:[],clubId:"",techId:"",consumeAmount:0,orderId:"",discount:0,amount:0,paidAmount:0,payNo:""}},created:function(){var e=this,n=e.global,t=n.currPage.query;return e.clubId=t.clubId||n.clubId,e.techId=t.techId,e.consumeAmount=t.total,e.isNativeOrder=!!t.batchNo,e.orderId=t.batchNo||t.orderId,e.discount=t.discount||0,e.payNo=t.payNo||"",e.clubId&&e.techId&&(e.consumeAmount||e.isNativeOrder)&&e.orderId?isNaN(e.consumeAmount)&&!e.isNativeOrder?(r.a.tipShow("页面参数不正确！"),e.$router.back()):(e.paramData=r.a.localStorage("pos-pay-param"),e.payAuthCode=t.code||n.authCode,void(n.userAgent.isWX&&e.paramData&&e.payAuthCode?i.a.getOpenId({authCode:e.payAuthCode}).then(function(n){e.openId=n.openid,e.init()}):e.init())):(r.a.tipShow(n.visitError),e.$router.back())},methods:{init:function(){var e=this,n=e.global,t=n.currPage.query;e.consumeAmount=e.consumeAmount-0,e.discount=e.discount-0,t.amount?e.amount=t.amount-0:e.amount=e.consumeAmount-e.discount,e.isNativeOrder?e.$http.get("../api/v2/club/native/batch/detail",{params:{batchNo:e.orderId,clubId:e.clubId}}).then(function(t){200==(t=t.body).statusCode?(t=t.respData,e.consumeList=t.details,e.consumeAmount=t.originalAmount,e.discount=t.discountAmount,e.paidAmount=t.paidAmount):r.a.tipShow(t.msg||"查询订单详情失败！"),n.loading=!1,setTimeout(function(){e.doPay()},1e3)}):(n.loading=!1,setTimeout(function(){e.doPay()},1e3)),e.$http.post("../api/v2/clubvisit/scan/paycode",{clubId:n.clubId,userId:n.userId,techId:e.techId}),e.$http.get("../api/v2/club/order/id/status/update",{params:{orderId:e.orderId}})},doPay:function(){var e=this,n=e.global.userAgent;return n.isWX||n.isAliPay?e.inProcessing?r.a.tipShow("支付中，请稍候..."):(e.inProcessing=!0,void e.$http.post("../api/v2/wx/pay/fast_pay/save",{payNo:e.payNo,amount:e.amount,clubId:e.clubId,techId:e.techId,bizId:e.orderId,consumeAmount:e.consumeAmount}).then(function(t){if((t=t.body).respData){if(0==t.respData.payAmount)return e.orderId=t.respData.bizId,e.afterPay(!0);var a=JSON.parse(t.respData);e.orderId=a.bizId}n.isWX?e.doInvokeWxPay(t):n.isAliPay&&e.doInvokeAliPay(t)},function(){e.inProcessing=!1,r.a.tipShow("支付请求失败！")})):r.a.tipShow("请在微信或者支付宝中打开！")},doInvokeAliPay:function(e){var n=this,t=n.global;if(200==e.statusCode){0==e.respData.payAmount&&n.afterPay(!0);var a=JSON.parse(e.respData);i.a.alipayJsBridgeReady(function(){AlipayJSBridge.call("tradePay",{tradeNO:a.tradeNO},function(e){n.inProcessing=!1,t.debugMode&&alert("支付宝支付结果："+o()(e)),"9000"==e.resultCode?n.afterPay():"8000"==e.resultCode?r.a.tipShow("正在处理中！"):"4000"==e.resultCode?r.a.tipShow("支付失败！"):"6001"==e.resultCode||"99"==e.resultCode?r.a.tipShow("您取消了支付！"):"6002"==e.resultCode&&r.a.tipShow("网络连接出错！")})})}else n.inProcessing=!1,r.a.tipShow(e.msg||"支付失败！")},doInvokeWxPay:function(n){var t=this;if(200==n.statusCode){0==n.respData.payAmount&&t.afterPay(!0);var a=JSON.parse(n.respData);i.a.wxJsBridgeReady(function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a.appId,timeStamp:a.timeStamp+"",nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign},function(n){t.inProcessing=!1,e.debugMode,n.err_msg&&n.err_msg.indexOf("ok")>=0?t.afterPay():r.a.tipShow("未能成功支付！")})})}else 935801==n.statusCode?(r.a.localStorage("pos-pay-param",t.money),i.a.getOauthCode("9358","fast-pay","base")):(t.inProcessing=!1,r.a.tipShow(n.msg||"支付失败！"),"PHONE_NOT_EXISTS"==n.respData&&i.a.bindTelPhone())},afterPay:function(e){r.a.tipShow("支付成功！"),this.getPrize()},getPrize:function(){var e=this;e.$http.get("../api/v2/user/fastpay/package/received",{params:{orderId:e.orderId}}).then(function(n){200==(n=n.body).statusCode&&(n.respData?e.$router.push({name:"fastPaySuccess",query:{orderId:e.orderId}}):e.$router.push({name:"home"}))},function(){r.a.tipShow("请求失败！")})}}}}).call(n,t("nvO+"))},BJx3:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=t("1es7"),o={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"page",attrs:{id:"pos-pay-page"}},[t("div",{staticClass:"top-wrap"},[t("router-link",{staticClass:"club-info",attrs:{tag:"div",to:{path:"/"+e.clubId+"/home"}}},[t("div",{style:{"background-image":"url("+e.global.clubLogoUrl+")"}}),t("span",[e._v(e._s(e.global.clubName))])]),e._v(" "),e._l(e.consumeList,function(n,a){return t("ul",{directives:[{name:"show",rawName:"v-show",value:e.consumeList.length>0,expression:"consumeList.length>0"}],key:a,staticClass:"consume-list"},[t("li",[t("div",{staticClass:"room-info"},[e._v(e._s(n.roomTypeName)+"："),t("b",[e._v(e._s(n.roomName))]),t("span",[e._v("客单号："),t("b",[e._v(e._s(n.userIdentify))])])]),e._v(" "),t("ul",e._l(n.itemList,function(n){return t("li",{key:n.$index,staticClass:"consume-item-info"},[t("div",{staticClass:"service-item-info"},[e._v(e._s(n.itemName)+" * "+e._s(n.itemCount)),t("span",[e._v("￥"+e._s(e._f("MoneyFormatter")(n.itemCount*n.itemAmount)))])]),e._v(" "),e._l(n.employeeList,function(n){return t("div",{directives:[{name:"show",rawName:"v-show",value:n.employeeNo,expression:"employee.employeeNo"}],key:n.$index,staticClass:"tech-item-info"},[e._v("技师：["+e._s(n.employeeNo)+"]"),t("span",[e._v(e._s(n.bellName))])])})],2)}))])])}),e._v(" "),t("div",{staticClass:"item"},[e._v("消费"),t("span",[e._v(e._s(e._f("MoneyFormatter")(e.consumeAmount))+" 元")])]),e._v(" "),t("div",{staticClass:"item"},[e._v("减免"),t("span",[e._v("-"+e._s(e._f("MoneyFormatter")(e.discount))+" 元")])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isNativeOrder,expression:"isNativeOrder"}],staticClass:"item"},[e._v("已付"),t("span",[e._v(e._s(e._f("MoneyFormatter")(e.paidAmount))+" 元")])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isNativeOrder,expression:"isNativeOrder"}],staticClass:"item"},[e._v("待付"),t("span",[e._v(e._s(e._f("MoneyFormatter")(e.consumeAmount-e.discount-e.paidAmount))+" 元")])]),e._v(" "),t("div",{staticClass:"item pay"},[e._v(e._s(e.isNativeOrder?"本次支付":"应付")),t("span",[e._v("￥"+e._s(e._f("MoneyFormatter")(e.amount)))])])],2),e._v(" "),t("div",{staticClass:"pay-btn",class:{alipay:e.global.userAgent.isAliPay},on:{click:function(n){e.doPay()}}},[e._v(e._s(e.inProcessing?"支付中...":e.global.userAgent.isAliPay?"支付宝支付":"微信支付"))])])},staticRenderFns:[]};var i=function(e){t("Wx5u")},r=t("Z0/y")(a.a,o,!1,i,null,null);n.default=r.exports},Wx5u:function(e,n,t){var a=t("q3kz");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);t("FIqI")("14c48c8f",a,!0,{})},q3kz:function(e,n,t){(e.exports=t("XLS9")(!1)).push([e.i,'\n.clearfix {\n  display: inline-block;\n}\n.clearfix:after {\n    display: block;\n    content: ".";\n    height: 0;\n    line-height: 0;\n    clear: both;\n    visibility: hidden;\n}\n@media (-webkit-min-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.7);\n    transform: scaleY(0.7);\n}\n}\n@media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {\n.border-1px::after {\n    -webkit-transform: scaleY(0.5);\n    transform: scaleY(0.5);\n}\n}\ndiv#pos-pay-page {\n  background: #eee;\n  padding: 0.72222rem 0;\n}\ndiv#pos-pay-page .top-wrap {\n    position: relative;\n    background: #fff;\n    margin: 0 0.66667rem;\n    border-radius: 0.33333rem;\n    -webkit-box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.05);\n            box-shadow: 0 1px 1px 2px rgba(0, 0, 0, 0.05);\n    padding-bottom: 0.22222rem;\n}\ndiv#pos-pay-page .top-wrap:before, div#pos-pay-page .top-wrap:after {\n      content: "";\n      position: absolute;\n      width: 0.83333rem;\n      height: 0.83333rem;\n      top: 3rem;\n      background: #eee;\n      border-radius: 50%;\n}\ndiv#pos-pay-page .top-wrap:before {\n      left: -0.41667rem;\n}\ndiv#pos-pay-page .top-wrap:after {\n      right: -0.41667rem;\n}\ndiv#pos-pay-page .top-wrap .club-info {\n      position: relative;\n      height: 3.38889rem;\n      line-height: 3.38889rem;\n      color: #4d4d4d;\n      font-size: 1.05556rem;\n      padding-right: 1rem;\n      text-align: right;\n      border-bottom: 1px dotted #e1e1e1;\n      margin-bottom: 0.27778rem;\n}\ndiv#pos-pay-page .top-wrap .club-info > div {\n        position: absolute;\n        width: 1.83333rem;\n        height: 1.83333rem;\n        left: 1.11111rem;\n        top: 50%;\n        margin-top: -0.91667rem;\n        border-radius: 50%;\n        background-size: 1.83333rem 1.83333rem;\n        background-repeat: no-repeat;\n}\ndiv#pos-pay-page .top-wrap .item {\n      padding: 0 1.11111rem;\n      font-size: 0.88889rem;\n      color: #4d4d4d;\n      line-height: 2.2;\n}\ndiv#pos-pay-page .top-wrap .item > span {\n        float: right;\n}\ndiv#pos-pay-page .top-wrap .pay {\n      margin-top: 0.83333rem;\n      height: 2.5rem;\n      line-height: 2.5rem;\n}\ndiv#pos-pay-page .top-wrap .pay > span {\n        color: #212121;\n        font-size: 1.66667rem;\n}\ndiv#pos-pay-page .pay-btn {\n    height: 2.22222rem;\n    line-height: 2.22222rem;\n    text-align: center;\n    margin: 2.5rem 0.66667rem 0;\n    background: #3cae34;\n    color: #fff;\n    font-size: 1rem;\n    border-radius: 0.27778rem;\n    letter-spacing: 2px;\n}\ndiv#pos-pay-page .pay-btn.alipay {\n      background: #00aaef;\n}\ndiv#pos-pay-page .consume-list {\n    border-bottom: 1px solid #e4e4e4;\n    padding: 0 0.91667rem;\n    margin-bottom: 0.55556rem;\n}\ndiv#pos-pay-page .consume-list > li {\n      border-bottom: 1px dashed #e4e4e4;\n}\ndiv#pos-pay-page .consume-list > li:last-child {\n        border-bottom: none;\n}\ndiv#pos-pay-page .room-info {\n    font-size: 0.83333rem;\n    color: #7997b7;\n    margin-bottom: 0.44444rem;\n    line-height: 1.65;\n}\ndiv#pos-pay-page .room-info > span {\n      float: right;\n}\ndiv#pos-pay-page .room-info b {\n      font-size: 1rem;\n      font-weight: normal;\n}\ndiv#pos-pay-page .consume-item-info {\n    position: relative;\n    margin-bottom: 0.27778rem;\n    padding: 0 0.55556rem;\n}\ndiv#pos-pay-page .consume-item-info:before {\n      content: "";\n      position: absolute;\n      left: 0;\n      top: 0.55556rem;\n      display: block;\n      width: 0.22222rem;\n      height: 0.22222rem;\n      border-radius: 50%;\n      background: #ecddbc;\n}\ndiv#pos-pay-page .service-item-info, div#pos-pay-page .tech-item-info {\n    font-size: 0.77778rem;\n    color: #666;\n    line-height: 1.6;\n}\ndiv#pos-pay-page .service-item-info > span {\n    float: right;\n}\ndiv#pos-pay-page .tech-item-info > span {\n    color: #7fbdff;\n    margin-left: 0.38889rem;\n}\n',""])}});